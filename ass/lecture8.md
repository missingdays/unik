## Обращение к параметрам внутри процедуры
Используется регистр bp. В самом начале процедуры содержимое сохраняется в стеке, и в него скорпировать значение регистра sp. 

```assembly
proc:
	push bp
	mov bp, sp

	mov ax, [bp+4] ; arg0
	mov bx, [bp+6] ; arg1
	mov cx, [bp+8] ; arg2

	pop bp
	ret 6
```

После этого становятся доступны параметры, которые мы можем использовать по назначению.

Перед возвратом из процедуры надо восстановить значение bp из стека. Чтобы извлечь параметры из стека при выходе из процедуры используется команда ret с указанием числа байтов, используемых под параметры.


### Пример процедуры с параметрами

```
dseg segment data
	a dw 81
	b dw 25
	c dw 0
dseg end

calc:
	push bp
	mov bp, sp
	push dx
	mov ax, [bp+4]  ; ax <- a
	add ax, [bp+6]  ; ax <- a + b
	cwd             ; dx:ax <- ax <- a + b
	idiv word[bp+8] ; ax <- (a + b) / c
	pop dx
	pop bp
	ret 6	

cseg
	... ; инициализация
	push 3
	push [b]
	push [a]

	call calc
	mov x, ax
```

### Команды прерывания и прерывание от внешних устройств
int реализует прерывание

Прерывания в большинстве случаев связаны с реальными устройствами, то есть каждому устройству соотсветствует определенный номер прерывания. Массив таких номеров прерываний при загрузке компьютера считывается из CMOS памяти в оперативную память. Имеется возможность переназначать номера векторов прерывания тем или иным устройством. Это делается в рамках программы setup комплекта программ BIOS, но не рекомендуется. Такие прерывания (связанные с реальными устройствами) - аппаратные прерывания. Програмные прерывания связаны с определенными фрагментами кода программы. 

1. 00h - внутреннее прерывание вычислительной машины, связано с делением на 0.
2. 09h - прерывание от клавиатуры
3. 0Eh - прерывание FDD
4. 76h - прерывание жесткого FDD
5. 23h - прерывание мышки
6. 14h - последовательный порт
7. 17h - порт LPT
8. 70h - прерывание от часов реального времени

### Программные прерывания
1. 10h - видео система BIOS
2. 13h - работа с диском BIOS
3. 16h - клавиатура BIOS
4. 21h
5. 23h - прерывание по умолчанию осуществляется при выходе из программы

Номера вектором прерывания IRQ

1. IRQ0 - прерывание системного таймера (частота - 18.2 Гц)
2. IRQ1 - клавиатура
3. IRQ8 - таймер (частота - 1024 Гц)
4. IRQ9 - обратный ход луча
5. IRQ12 - мышка
6. IRQ13 - ошибка математичекого сопроцессора
7. IRQ3 - COM2
8. IRQ4 - COM1
9. IRQ5 - LPT2
10. IRQ7 - LPT1
11. IRQ6 - дисковод

### Обработчики прерываний
Когда выполняется команда `int`, управление передается по адресу, который считывается из специального массива (таблица векторов прерываний). Каждый элемент этого массива представляет собой дальний адрес обработчика прерываний в следующем формате `сегмент:смещение`.

Команда `int` помещает в стек весь регистр флагов и дальний адрес возврата. Следовательно, чтобы завершить обработчик, надо выполнить команды 
```assembly
popf
retf
```
или

```assembly
iret
```

#### Пример
```assembly
int_handler proc far
	... ; тело

	iret
int_handler endp
```

Привязка может выглядеть следующим образом
```assembly
push 0  ; сохраняет в стеке адрес таблицы векторов прерывания
pop es 
pushf
cli     ; запрещаем прерывания
mov word ptr es:[4ah*4], offset int_handler ; 4ah - номер прерывания
mov word ptr es:[4ah*4 + 2], seg int_handler
popf ; после этого команда int 4ah будет вызывать наш обработчик
```

