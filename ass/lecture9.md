## Принцип программирования внешних устройств на примере мыши
Для обработки прерывания мыши используется 
```assembly
int 33h
```

#### Инициализация мыши
```assembly
mov ax, 0h
int 33h
```
Если в ax останется 0, значит драйвера мыши в системе не установлены.

Если в bx 
- лежит 2, значит у данной мыши 2 кнопки
- лежит 3, значит у мыши 3 кнопки
- лежит 0, значит другие варианты


#### Работа с мышью
```
mov ax, 1 ; показывать курсор
int 33h
```

или 

```
mov ax, 2 ; не показывать курсор
int 33h
```

Определение состояния мыши через регистр bx. Младшие биты bx - (правая клавиша мыши)(средняя клавиша)(левая клавиша)

cx - координата X нажатия мыши

dx - коориданата Y
```assembly
mov ax, 3
int 33h
```
Команда медленная, поэтому для быстрой работы с мышью целесообразно использовать обработчик событий.

#### Обработчик событий

```assembly
mov ax, 0Ch
int 33h
```

es:dx - адрес обработчика
cx - условие вызова. 

- 0 бит - перемещение мыши
- 1 бит - нажатие левой кнопки
- 2 бит - отпуск левой кнопки
- 3 бит - нажатие правой кнопки
- 4 бит - отпуск правой кнопки
- 5 бит - нажатие средней кнопки
- 6 бит - отпуск средней кнопки

Если в cx лежит во всех битах 0, означает отмену обработчика.

Обработчик оформляется как дальная процедура. На входе в процедуру регистры несут следующую нагрузку.

- ax - условие вызова
- bx - состояние кнопок
- cx, dx - координаты
- si, di - координаты последнего перемещения
- ds - адрес драйвера мыши

#### Установка указателя мыши в требуемое место

```assembly
mox ax, 4
mov cx, X
mov dx, Y
int 33h
```


### Пример работы с мышью
```assembly
start:
	mov ax, 12h
	int 10h
	mov ax, 03h
	int 10h

	mov ax, 0
	int 33h
	mov ax, 1
	int 33h

	mov ax, 0Ch
	mov cx, 10d

	mov dx, offset handler
	int 33h

	mov ah, 0
	int 16h

	mov ax, 0Ch
	mov cx, 0
	int 33h

	mov ax, 3
```

Обработчик нажатия
```assembly
handler:
	push 0A00Ch ; помещение адрес сегмента видео памяти
	pop es
	pop ds

	push cx
	push dx

	cmp bx, 1
	jz left

	cmp bx, 2
	jz right

	mov ax, 09h
	mov dx, offset mleft
	int 21h
	jmp next

	right:
		mov ax, 09h
		mov dx, offset mright
		int 21h

	next:
		pop dx
		pop cx
```